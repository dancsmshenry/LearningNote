# Epoll

### 内部结构

- 用一个红黑树记录添加的socket，用一个双向链表接收内核触发的事件

- 是系统级别的支持

- ```cpp
  struct eventpoll {
      struct rb_root rbr;//红黑树的根节点，这棵树中存储所有添加到epoll中的需要监控的事件
      struct list_head rdlist;//双向链表中存放着将要通过epoll_wait返回给用户的满足条件的事件
  };
  ```

- 为什么支持百万句柄

  - 不用重复传递，调用epoll_wait时相当于以往调用

- 为什么用红黑树

  - 早期使用hashmap效率高，但是内存空间占用大，就改为了红黑树
  - 同时kernel中有现有的rbtree，而没有通用的hashtable

# linux下是如何接收数据的





# epoll的使用api（每一步api具体实现了什么功能）





# epoll中的数据结构（以及为什么要用这些数据结构）

- 程序在内核空间开辟一块缓存，用来管理epoll的红黑树，以此实现高效的添加和删除
- 红黑树位于内核空间，用来直接管理socket，减少和用户态的交互
- 使用双向链表缓存就绪的socket，数量较少
- 只需要拷贝这个双向链表到用户空间，在遍历即可，注意这里也需要拷贝，没有共享内存



- 红黑树（方便事件的查询和删除，还有插入，背景：有些事件一开始是要监听的）







# Select



# Poll



- 



# 