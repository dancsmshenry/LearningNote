# swtich

- 当 case 语句少的时候，C编译器将其转成 if..else.. 类型进行处理，运用较多的cmp 与 jmp 语句
- 而当 case 语句较多的时候，C编译器会出成一个跳转表，而直接通过跳转表进行跳转，这让 switch 具有非常高的效率，而且效率几乎不会因为case 语句的增长而减小
  - 跳转表是一个数组，表项i是一个代码段的地址，这个代码段实现当switch索引值等于i时程序应该执行的动作
  - 程序代码用于索引值来执行一个跳转表内的数组引用，确定跳转指令的目标



- switch使用查找表的方式决定了case的条件最好是一串连续的常量

- 而在switch中的数据有比较大的跨越的情况下，会浪费很多无用的地址存储default的跳转地址，这个时候编译器会进行一个选择，到底是写成跳转表的形式还是cmp然后jmp的形式



- “case 常量表达式”只相当于一个语句标号，表达式的值和某标号相等则转向该标号执行，但不能在执行完该标号的语句后自动跳出整个switch 语句
- 所以必须在执行完case后break







# 与if的效率相比

- if-else只是单纯地一个接一个比较，效率比较低
  - if…else 是每个条件都要计算一遍的
- switch的效率一般比if-else高
  - 从汇编代码可以看出来，switch 只计算一次值，然后都是test , jmp



- 当然，switch的效率与分支数无关
  - 分支比较少的时候，if效率比switch高（因为switch有跳转表）
  - 分支比较多的时候，那当然是switch