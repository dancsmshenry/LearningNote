# 作用

没有类的情况

- 隐藏。
  - 所有不加static的全局变量和函数具有全局可见性，可以在其他文件中使用，加了之后只能在该文件所在的编译模块中使用
  - 当同时编译多个文件时，所有未加static前缀的全局变量和函数都具有全局可见性。

- 默认初始化为0，包括未初始化的全局静态变量与局部静态变量，都存在全局未初始化区
  - 其实全局变量也具备这一属性，因为全局变量也存储在静态数据区。在静态数据区，内存中所有的字节默认值都是0x00
- 静态变量在函数内定义，始终存在，且只进行一次初始化，具有记忆性，其作用范围与局部变量相同，函数退出后仍然存在，但不能使用
  - 存储在静态数据区的变量会在程序刚开始运行时就完成初始化，也是唯一的一次初始化
- 保持变量内容的持久
  - 存储在静态数据 区的变量会在程序刚开始运行时就完成初始化




有类的情况

- static成员变量：
  - 只与类关联，不与类的对象关联（对类的所有对象只有一份拷贝）
  - 定义时要分配空间，不能在类声明中初始化，必须在类定义体外部初始化，初始化时不需要标示为static
  - 可以被非static成员函数任意访问
- static成员函数：
  - 不具有this指针，无法访问类对象的非static成员变量和非static成员函数，因而只能访问类的 static 成员变量
  - 不能被声明为const、virtual和volatile
  - 可以被非static成员函数任意访问（只可被类内的其它函数调用，这个函数的使用范围被限制在声明它的模块内；不能被模块外其它函数访问）
- static类对象：
  - 必须在类内声明，在类外进行初始化（static修饰的变量先于对象存在，如果是在类内初始化，会导致每个对象都包含该静态成员）





# 静态成员和普通成员的区别

- 生命周期
  - 静态成员变量从类被加载开始到类被卸载，一直存在；
  - 普通成员变量只有在类创建对象后才开始存在，对象结束，它的生命期结束
- 共享方式
  - 静态成员变量是全类共享
  - 普通成员变量是每个对象独享
- 定义位置
  - 普通成员变量存储在栈或堆中，而静态成员变量存储在静态全局区
- 初始化位置：普通成员变量在类中初始化；静态成员变量在类外初始化；
- 默认实参：可以使用静态成员变量作为默认实参





# 静态变量和全局变量的区别

- 全局变量（外部变量）的说明之前再冠以static就构成了静态的全局变量。 全局变量本身就是静态存储方式，静态全局变量当然也是静态存储方式。 这两者在存储方式上并无不同。这两者的区别在于非静态全局变量的作用域是整个源程序，当一个源程 序由多个原文件组成时，非静态的全局变量在各个源文件中都是有效的。 而静态全局变量则限制了其作用域，即只在定义该变量的源文件内有效，在同一源程序的其它源文件中 不能使用它。由于静态全局变量的作用域限于一个源文件内，只能为该源文件内的函数公用，因此可以 避免在其他源文件中引起错误。 static全局变量与普通的全局变量的区别是static全局变量只初始化一次，防止在其他文件单元被引用。 2.static函数与普通函数有什么区别？ static函数与普通的函数作用域不同。尽在本文件中。只在当前源文件中使用的函数应该说明为内部函 数（static），内部函数应该在当前源文件中说明和定义。 对于可在当前源文件以外使用的函数应该在一个头文件中说明，要使用这些函数的源文件要包含这个头 文件。 static函数与普通函数最主要区别是static函数在内存中只有一份，普通静态函数在每个被调用中维持一 份拷贝程序的局部变量存在于（堆栈）中，全局变量存在于（静态区）中，动态申请数据存在于（堆）





# 初始化的时间

- 静态局部变量和全局变量一样，数据都存放在全局区域，所以在主程序之前，编译器已经为其分配 好了内存
- 在C中，初始化发生在代码执行 之前，编译阶段分配好内存之后，就会进行初始化
  - 所以我们看到在C语言中无法使用变量对静态局部 变量进行初始化，在程序运行结束，变量所处的全局内存会被全部回收
- 在C++中，初始化时在执行相关代码时才会进行初始化
  - 主要是由于C++引入对象后，要进行初始 化必须执行相应构造函数和析构函数，在构造函数或析构函数中经常会需要进行某些程序中需要进行的 特定操作，并非简单地分配内存。所以C++标准定为全局或静态对象是有首次用到时才会进行构造，并 通过atexit()来管理





# 其他

- 在静态方法里面创建静态变量，那这个静态变量一开始会初始化吗
  - 答不会，参考线程安全的懒汉模式
- 如何实现局部变量只被初始化一次
  - 反汇编后发现，是有一个标志用来记录该局部静态变量是否初始化过，而这个标记可以同时保存8个静态变量的初始状态
  - 通常这个标志出现在最先定义的局部静态变量附近
  - 如果已初始化了，就跳过
  - 参考：https://www.cnblogs.com/yilang/p/12106236.html
  - https://www.cnblogs.com/xuxm2007/p/4652944.html