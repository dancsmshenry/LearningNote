# 定义

- volatile 关键字是一种类型修饰符，用它声明的类型变量表示可以被某些编译器未知的因素更改，比如： 操作系统、硬件或者其它线程等
- 遇到这个关键字声明的变量，编译器对访问该变量的代码就不再进行优化，从而可以提供对特殊地址的稳定访问
- 当要求使用 volatile 声明的变量的值的时候，系统总是重新从它所在的内存读取数据，即使它前面的指令刚刚从该处读取过数据。而 且读取的数据立刻被保存



```cpp
int volatile vint;//语法
```



应用

- 中断服务程序中修改的供其它程序检测的变量需要加volatile
- 多任务环境下各任务间共享的标志应该加volatile
- 存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能由不同意义







# volatile指针

- ```cpp
  volatile char* vpch;	//是指向一个volatile对象的指针
  char * volatile pchv;	//是一个volatile的指针
  // 理解上和const指针类似
  ```

- 注意：
  - 可以把一个非volatile int赋给volatile int（基础类型），但是不能把非volatile对象赋给一个volatile对象（自定义对象）
  - 除了基本类型外，对用户定义类型也可以用volatile类型进行修饰
  - C++中一个有volatile标识符的类只能访问它接口的子集，一个由类的实现者控制的子集。用户只能用 const_cast来获得对类型接口的完全访问。此外，volatile向const一样会从类传递到它的成员







# 多线程下的volatile

背景

- 如果变量被装入寄存器，那么两个线程有可能一个使用内存中的变量，一个使用寄存器中的变量，这会造成程序的错误执行



解决

- volatile的意思是让编译器每次操作该变量时一定要从内存中真正取出，而不是使用已经存在寄存器中的值