## 3、Cpp 中内存分配情况

- 分别是堆，栈，自由存储区，全局/静态存储区，常量存储区和代码区

- 栈

  - 在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放
  - 栈内存分配运算内置于处理器的指令集中，效率很高，但是分配的内存容量有限

- 堆

  - 就是那些由 new分配的内存块，他们的释放编译器不去管，由我们的应用程序去控制，一般一个new 就要对应一个 delete。如果程序员没有释放掉，那么在程序结束后，操作系统会自动回收（操作系统不回收的话那就是内存泄漏了）

- 自由存储区

  - 是C++中通过new和delete动态分配和释放对象的抽象概念
  - 需要注意的是，自由存储区和堆比较像，但不等价

- 全局/静态存储区

  - 全局变量和静态变量被分配到同一块内存中
  - 在以前的C语言中，全局变量和静态变量又分为初始化的和未初始化的，在C++里面没有这个区分了，它们共同占用同一块内存区，在该区定 义的变量若没有初始化，则会被自动初始化，例如int型变量自动初始为0

- 常量存储区

  - 挖坑：在 c 语言中，局部的 const 设定的变量是存放在栈里面的，全局的 const 才是放在常量存储区的

    - ```c
      #include <stdio.h>
      
      const char a = 'a';//无法运行，因为全局的const变量是存放在常量存储区的
      
      int main(){
          // const char a = 'a';//可以运行，局部是在栈里面的
          printf("%c\n", a);
      
          char *b = &a;
          *b = 'A';
          printf("%c\n", a);
      
          return 0;
      }
      ```

  - 存放的是常量，不允许修改

- 代码区

  - 存放函数体的二进制代码

- - 





## 1、堆和栈的区别

- 申请方式不同
  - 堆是由使用者申请和释放的
  - 栈是由系统自动分配的
- 申请大小不同
  - 栈顶和栈底都是预先定好的，栈是向栈底拓展，大小固定（默认4M）
  - 堆向高地址拓展，是不连续的内存区域，大小可以灵活调整（一般是1G-4G）
- 申请效率不同
  - 栈由系统分配，速度快，不会有碎片
  - 堆由程序员分配，速度慢，且会有碎片
- 为什么效率不同
  - 操作系统会在底层对栈提供支持，会分配专门的寄存器存放栈的地址，栈的入栈出栈操作也十分简单，并且有专门的指令执行，所以栈的效率比较高也比较快
  - 堆的操作是由C/C++函数库提供的，在分配堆内存的时候需要一定的算法寻找合适大小的内存。并且 获取堆的内容需要两次访问，第一次访问指针，第二次根据指针保存的地址访问内存，因此堆比较慢