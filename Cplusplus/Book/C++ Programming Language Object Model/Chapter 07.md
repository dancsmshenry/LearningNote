# 7.1 模板及其实例化详细分析

- 函数模板

  - 编译器编译时，根据针对函数的调用参数来确定T的类型
  - 如果没有针对函数的代码，编译器不会为我们产生任何和函数有关的代码

- 类模板的实例化分析

  - 如果没有用来该类，那么编译器不会产生该类相关的代码

  - 模板中的枚举类型（和模板本身关系不大）

  - 类模板中的静态成员变量

    - ```cpp
      template<class T>
      class A {
      public:
          static int i;
      };
      
      template<class T> int A<T>::i = 1111;
      
      int main() {
          A<int>::i = 111;
          A<double>::i = 121;
          cout << A<int>::i << endl;//111
          cout << A<double>::i << endl;//121
          //说明不同的类型会导致静态成员变量的不同，而具体的类并没有被实例化
      }
      ```

  - 类模板的实例化

    - ```cpp
      A<int> *p = nullptr;//这种写法不会实例化类
      const A<int>& p = 0;//这种写法会实例化类
      ```

  - 成员函数的实例化

    - 如果没有用到函数的话，是不会实例化出来这个函数的

- 多个源文件中使用类模板

  - 在多个obj文件中可能会产生多个重复的类模板，对应的具体的实例化类，但链接的时候只会保留一个实体，其他的会被忽略
  - 虚函数的实例化（虚函数即使没有被调用，但也会被实例化出来）
  - 显式实例化语法（`template class A<int>;`，即使没有使用这个类，这种语法会把模板类的所有内容都实例化出来；或者实例化单独的成员函数：`template void A<int>::func() const;`，但是没有实例化出int的类本身）

<br/>

<br/>

# 7.2 歪门邪道，推荐书籍，结束语

- 不能被继承的类

  - cpp11中可以用final来实现

  - 在此之前是通过友元函数+虚继承来实现的（副作用：友元：破坏封装性，虚继承：消耗较大）

  - ```cpp
    class A {
        private:
        	A() = default;
        	friend class B;
    };
    
    class B: virtual public A {
        
    };//这样B类就无法被继承了
    ```

  - 原因：如果要继承B类，那么就要调用A类的构造函数，在没有虚继承的时候，因为B类是A类的友元类，所以B类可以调用A类的私有构造函数，但是有了虚继承以后，A类的构造函数是要通过孙子类来调用的，而孙子类不是A类的友元类，所以孙子类是无法调用A类的构造函数的，即孙子类无法构造出来，即B类无法被继承

- 类外调用私有虚成员函数

  - 无非就是走虚函数表来调用虚函数

  - ```cpp
    class V {
    private:
        virtual void virfunc() {
            myfunc();
        }
    
        void myfunc() {
            cout << "!!!!!" << endl;
        }
    };
    
    int main() {
        V obj;
    //    (reinterpret_cast<void(*)()>(**(int**)(&obj)))();
        long long *pvptr = (long long*)&obj;//把对象obj的地址拿到（&取地址，long long转类型）
        long long *vptr = (long long*)(*pvptr);//拿到虚函数表指针
        typedef void(*FUNC)(void);//定义一个函数指针类型
        FUNC f = (FUNC)vptr[0];//给虚函数表指针f赋值为第一个虚函数地址
        f();//调用虚函数
    }
    ```

- 书籍推荐

  - 程序员的自我修养-链接、装载与库

- 学习之道

  - 选对老师走对路
  - 学精不要学杂，不要贪大贪全，否则会分散精力，浪费时间
  - 尽早选择一条能拿高薪的路，一直不断的努力达成目的