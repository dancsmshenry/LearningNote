### 第五章 运输层

- 运输层向它上面的应用层提供通信服务
- 两台主机之间的通信，是这台主机中的一个进程和另一台主机中的进程在交换数据
- 从运输层的角度看，通信的真正端点并不是主机而是主机中的进程
- 运输层的复用和分用
  - 复用：发送方不同的应用进程都可以使用同一个运输层协议传送数据（应用层所有的应用进程都可以通过运输层在传给IP层）
  - 分用：接收方的运输层在剥去报文的首部后能够把这些数据正确交付目的进程（运输层从IP层受到发送给各应用进程的数据后，必须分别交付指明的各应用进程）
- 运输层提供应用进程间的逻辑通信，而网络层为主机之间提供逻辑通信
- 两种运输协议：面向连接的TCP（Transmission Control Protocol）和无连接的UDP（User Datagram Protocol）
  - 当采用TCP协议时，尽管下面的网络是不可靠的，但这种逻辑通信信道就相当于一条全双工的可靠信道
  - 采用UDP时，仍是一条不可靠信道
- 两个对等运输实体在通信时传送的数据单位叫运输协议数据单元
  - 在TCP中叫做TCP报文段，在UDP中叫做UDP用户数据报
- UDP在传送数据之前不需要先建立连接，TCP则提供面向连接的服务
- 协议端口号：
  - 软件端口是应用层的各种协议进程与运输实体进行层间交互的一种地址
  - 端口号只具有本地意义，他只是为了标志本计算机应用层中的各个进程在和运输层交互时的层间接口
- 服务端使用的端口号
  - 熟知端口号，一些常用的端口号，如FTP，HTTP等
  - 登记端口号，为没有熟知端口号的应用程序设定
- 客户端使用的端口号
  - 仅在客户进程运行时才动态选择，又称为短暂端口号
  - 通信结束后，已使用过的客户端口号就不复存在了，这个端口号就可以供其他客户进程使用
- UDP
  - 特点：
    - 是无连接的，即发送数据之前不需要建立连接（发送数据结束后也没有连接可释放）
    - 尽最大努力交付，即不保证可靠交付
    - 面向报文的，对于应用层交下来的报文，不合并也不拆分，保留报文的边界
    - 没有拥塞控制（实时应用的要求：允许在网络发生拥塞时丢失一些数据，不允许数据有太大的时延）
    - 支持一对一、一对多、多对一和多对多的交互通信
    - 首部开销小，只有八个字节
  - UDP有两个字段：数据字段和首部字段
  - 首部字段（八个字节，四个字段）：
    - 源端口，目的端口，长度（整个UDP数据报的长度），检验和（检测UDP数据是否在传输中出错）
  - 虽然用到端口号，但是udp是无连接的，所以不需要套接字连接

