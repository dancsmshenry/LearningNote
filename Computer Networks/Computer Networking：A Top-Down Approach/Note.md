# 第三章

- TCP套接字：两个具有不同源IP地址或源端口号的到达TCP报文段将被定向到两个不同的套接字上
- UDP套接字：如果两个UDP报文段有不同的源IP地址和/或源端口号，但具有相同的目的IP地址和目的端口号，那么这两个报文段将通过相同的目的套接字被定向到相同的目的进程

- 虽然udp不可靠，但是udp就必须再端到端基础上在运输层提供差错检测（即校验和），端到端原则
- arp自动重传请求协议：差错检测，接收方反馈，重传



dns查询

- 主机向本地域名服务一般是采用递归查询
  - 如果主机所询问的本地域名服务器不知道被查询的域名的ip地址，那本地域名服务器就以dns客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。
  - 因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址
  - 说白了，就是你找我查，我不知道，我就替你去问别人，别人不知道，就代我再去问别人
- 本地域名服务器向根域名服务器的查询时迭代查询
  - 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。
  - 然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。
  - 结果：查询ip地址，或告诉本地服务器下一步应当向哪一个权限服务器进行查询
  - 说白了，你找我查，我不知道，但我告诉你谁有可能知道，你去找他



# TCP报文详解

- 源端口和目的端口（16*2位）
- 序号（sequence number）报文段发送的数据的第一个字节的序号
- 确认号（acknowledgement number）期待收到对方的下一个报文段的第一个数据字节
  - 表明到序号N-1的所有数据都已收到
- 数据偏移：TCP报文段的首部长度
- 确认（ACK）仅当为1的时候有效，为0的时候无效，在连接建立后，所有报文段都为1
- 同步（SYN）
  - SYN=1,ACK=0,连接请求
  - SYN=1,ACK=1,连接接受
  - SYN=1表示连接请求，连接接受
- 终止（FIN）释放连接，FIN=1，报文段的发送方的数据发送完毕
- 窗口，作为接收方让发送方设置其发送窗口的一句
- 检验和（伪首部+报文段）
- MSS：每一个TCP报文段中的数据字段的最大长度



# 对拥塞控制和流量控制的理解

- 流量控制
  - 对应的是滑动窗口
  - 接收方与发送方对数据包的处理速度不同
  - 接收方控制，发送方执行
  - 考虑的是端到端的情况
  - 例子：对于接收方来说，数据包太大，缓冲区太多还没有处理好的数据包；发送方收到这个信息以后，就把窗口缩小
  - 感觉流量控制针对的是单个数据包，接收方如果觉得发的太快了，处理不过来，就会告诉发送方，把数据包的大小缩小
- 拥塞控制
  - 拥塞窗口：发送方在一个RTT内可以最多发送的数据包
  - 而拥塞窗口，是针对网络中太过拥挤的时候，就要减少发送数据包的数量，使用慢开始等发送算法



# TCP的主要问题

- TCP报文
  - 报文的基本内容
  - ISN是否是固定的
- 三次握手和四次挥手
  - 三次握手和四次挥手的基本内容
  - 为什么TIME_WAIT状态需要经过2MSL才能返回到CLOSE状态
  - 为什么四次挥手释放连接时，需要等待2MSL
  - 为什么要四次挥手，三次握手
  - 三次握手的过程中可以携带数据吗
  - 全连接和半连接队列
- 超时重传和滑动窗口
  - 滑动窗口、超时重传的基本概念
  - RTO，RTT
- 流量控制和拥塞控制
  - 解释拥塞控制的四大算法（满开始，拥塞避免，快重传，快恢复）
  - 为什么快速重传是重复发送3次ack
- TCP传输的安全
  - SYN攻击
- 综合性的问题
  - tcp与udp的区别（从整个流程谈起）
  - tcp如何保障可靠传输（从tcp的整个传输流程讲起：确认和重传，数据校验，数据合理分片和排序，流量控制，拥塞控制）
  - 发生粘包、拆包的时候如何处理
  - 建立tcp连接的服务器和客户端的系统调用（bind，listen，accept，connect）