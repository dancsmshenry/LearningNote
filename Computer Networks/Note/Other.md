# DNS

作用：将域名⽹址⾃动转换为具体的 IP 地址



域名解析的工作流程

- 1、浏览器⾸先看⼀下⾃⼰的缓存⾥有没有，如果没有就向操作系统的缓存要，还没有就检查本机域名解析⽂件 hosts ，如果还是没有，就会 DNS 服务器进⾏查询
- 2、客户端⾸先会发出⼀个 DNS 请求，问 www.server.com 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端 的 TCP/IP 设置中填写的 DNS 服务器地址）
- 3、本地域名服务器收到客户端的请求后:
  - 如果缓存⾥的表格能找到 www.server.com，则它直接返回 IP 地址
  - 如果没有，本地 DNS 会去问它的根域名服务器：“⽼⼤， 能告诉我 www.server.com 的 IP 地址吗？” （根域名服务器是最⾼层次的，它不直接⽤于域名解析，但能指明⼀条道路）
- 4、根 DNS 收到来⾃本地 DNS 的请求后，发现后置是 .com，说：“www.server.com 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址给你，你去问问它吧。”
- 5、本地 DNS 收到顶级域名服务器的地址后，发起请求问“⽼⼆， 你能告诉我 www.server.com 的 IP 地址吗？”
- 6、顶级域名服务器说：“我给你负责 www.server.com 区域的权威 DNS 服务器的地址，你去问它应该能问到”。
- 7、本地 DNS 于是转向问权威 DNS 服务器：“⽼三，www.server.com对应的IP是啥呀？” server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主
- 8、权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS
- 9、本地 DNS 再将 IP 地址返回客户端，客户端和⽬标建⽴连接

- ![](域名解析的工作流程.png)







# ARP

作用：将ip地址转换为mac地址



ARP 是借助 ARP 请求与 ARP 响应两种类型的包确定 MAC 地址的

- 主机会通过⼴播发送 ARP 请求，这个包中包含了想要知道的 MAC 地址的主机 IP 地址
- 当同个链路中的所有设备收到 ARP 请求时，会去拆开 ARP 请求包⾥的内容，如果 ARP 请求包中的⽬标 IP 地址与⾃⼰的 IP 地址⼀致，那么这个设备就将⾃⼰的 MAC 地址塞⼊ ARP 响应包返回给主机
- 操作系统通常会把第⼀次通过 ARP 获取的 MAC 地址缓存起来，以便下次直接从缓存中找到对应 IP 地址的 MAC 地址
- 不过，MAC 地址的缓存是有⼀定期限的，超过这个期限，缓存的内容将被清除







# RARP

作用：将mac地址转换为ip地址



使用步骤

- 通常这需要架设⼀台 RARP 服务器，在这个服务器上注册设备的 MAC 地址及其 IP 地址。然后再将这个设备接入到⽹络 
- 该设备会发送⼀条「我的 MAC 地址是XXXX，请告诉我，我的IP地址应该是什么」的请求信息。 
- RARP 服务器接到这个消息后返回「MAC地址为 XXXX 的设备，IP地址为 XXXX」的信息给这个设备。 
- 最后，设备就根据从 RARP 服务器所收到的应答信息设置⾃⼰的 IP 地址







# DHCP

作用：接入网络的设备获取其在网络的ip地址



工作流程

- 客户端⾸先发起 DHCP 发现报⽂（DHCP DISCOVER） 的 IP 数据报，由于客户端没有 IP 地址，也不知道 DHCP 服务器的地址，所以使⽤的是 UDP ⼴播通信，其使⽤的⼴播⽬的地址是 255.255.255.255（端⼝ 67） 并且使⽤ 0.0.0.0（端⼝ 68） 作为源 IP 地址。DHCP 客户端将该 IP 数据报传递给链路层，链路层然后 将帧⼴播到所有的⽹络中设备。 
- DHCP 服务器收到 DHCP 发现报⽂时，⽤ DHCP 提供报⽂（DHCP OFFER） 向客户端做出响应。该报⽂仍 然使⽤ IP ⼴播地址 255.255.255.255，该报⽂信息携带服务器提供可租约的 IP 地址、⼦⽹掩码、默认⽹关、 DNS 服务器以及 IP 地址租⽤期。 
- 客户端收到⼀个或多个服务器的 DHCP 提供报⽂后，从中选择⼀个服务器，并向选中的服务器发送 DHCP 请 求报⽂（DHCP REQUEST进⾏响应，回显配置的参数。 
- 最后，服务端⽤ DHCP ACK 报⽂对 DHCP 请求报⽂进⾏响应，应答所要求的参数。
- ![](DHCP工作流程.png)



如果租约的 DHCP IP 地址快期后，客户端会向服务器发送 DHCP 请求报⽂： 

- 服务器如果同意继续租⽤，则⽤ DHCP ACK 报⽂进⾏应答，客户端就会延⻓租期。 
- 服务器如果不同意继续租⽤，则⽤ DHCP NACK 报⽂，客户端就要停⽌使⽤租约的 IP 地址。



因为使用udp广播的，为了解决DHCP服务器和客户端不在同一个局域网下，使用DHCP中继代理

- DHCP 客户端会向 DHCP 中继代理发送 DHCP 请求包，⽽ DHCP 中继代理在收到这个⼴播包以后，再以单播的形式发给 DHCP 服务器
- 服务器端收到该包以后再向 DHCP 中继代理返回应答，并由 DHCP 中继代理将此包⼴播给 DHCP 客户端







# NAT

作用：同个公司、家庭、教室内的主机对外部通信时，把私有 IP 地址转换成公有 IP 地址







# ICMP

作用：

- 全名是互联网控制报文协议
- 主要功能包括
  - 确认 IP 包是否成功送达⽬标地址
  - 报告发送过程中 IP 包被废弃的原因和改善⽹络设置等



两大类

- ⼀类是⽤于诊断的查询消息，也就是「查询报⽂类型」 
- 另⼀类是通知出错原因的错误消息，也就是「差错报⽂类型」 



报文类型

- ![](ICMP报文类型.png)
