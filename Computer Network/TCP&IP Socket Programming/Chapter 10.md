# 第十章 多进程服务端

## 10.2 进程和僵尸进程

- 僵尸进程的定义：进程完成工作后（执行完main函数中的程序后）应被销毁，但有时这些进程将变成僵尸进程，占用系统中的重要资源

- 产生僵尸进程的原因

  - 传递参数并调用exit函数和饥饿main函数中执行return语句并返回值都会传递给操作系统，但是操作系统不会销毁子进程
  - 只到把这些值传递给产生该子进程的父进程，操作系统才会销毁子进程（只有父进程主动发起请求时，操作系统才会传递该值）

- 僵尸进程的销毁

  - 应该向创建子进程的父进程传递子进程的exit参数或return语句的返回值
  - 如果父进程为主动要求获得子进程的结束状态值，操作系统将一直保存，并让子进程长时间处于僵尸进程

- 销毁僵尸进程的方法

  - 1、利用wait函数

  - ```c
    #include <sys/wait.h>
    
    pid_t wait(int* statloc);//成功时返回终止的子进程ID，失败时返回
    //调用wait函数时，如果没有已终止的子进程，那么程序将阻塞直到有子进程终止
    
    //调用此函数时，如果已有子进程终止，那么子进程终止时传递的返回值（exit函数的参数值，main函数的return返回值）将保存到该函数的参数所指内存空间
    ```

  - 2、使用waitpid函数

  - ```c
    #include <sys/wait.h>
    
    pid_t waitpid(pid_t pid, int* statloc, int options);
    //pid，等待终止的目标子进程的ID，若传递-1，则与wait函数相同，可以等待任意子进程终止
    //statloc，与wait函数的statloc参数具有相同含义
    //options，传递头文件中声明的常量WNOHANG，即使没有终止的子进程也不会进入阻塞状态，而是返回0并退出函数
    
    //调用waitpid不会使程序阻塞
    ```



## 10.3 信号处理

- 

- - 