# http中间人攻击

## 背景（非对称加密）

- **RSA算法**利用了类似的技术，提供了两套密钥，**公钥和私钥**，二者并不相同，**公钥用于加密，私钥用于解密**。即使有中间人获得了公钥，仍然无法破解，因为**公钥只能加密，不能解密**。公钥可以公开给所有人使用，只要保存好私钥即可
- 比如访问百度的一个流程
  - 客户端用百度的公钥加密自己生成的一个随机数作为后续交互的密码
  - 百度收到了这个加密后得到的密码，并用百度的私钥解密了内容，获得后续交互密码，然后用这个密码进行交互
- 但是这里的一个问题就是，客户端如何确定这个公钥就是百度的？
- 这就是中间人攻击的基础
  - 客户端询问百度的公钥
  - 查询请求被中间人拦截，伪造了百度的公钥，换成中间人的公钥，比如中间人是知乎，那么就是知乎的公钥，同时中间人也持有对应的私钥（知乎的私钥）
  - 之后客户端的一切通信，在中间人（知乎）那里都会被中间人的私钥（知乎的私钥）给解开内容，因为中间人通过替换的中间人公钥以及对应的中间人私钥解开了交互密码



## 证书验证机制

- 为了解决上述问题，提供了一种名为证书验证机制的方法
- 证书的原理相当于对网站下发的公钥做一次哈希校验，然后与**本机预先存储的证书信息**做验证，如果一致，说明对方的公钥是可信的
- 而本地的证书，则是由证书颁发机构赋予的
- 证书颁发机构，本质上是一个收钱的机构，收钱，然后颁发一个可信的证书给网站，同时，操作系统厂商（Windows、Linux、MacOS）信任“证书颁发机构”颁发的证书，在浏览器或者操作系统里默认集成了这些机构的根证书，这样就保证了证书是可信可靠的
- 每个证书都是有有效期的，如果有网站恶意使用了证书，那么“证书颁发机构”就会吊销对应的证书，之后浏览器再访问这些网站的时候，如果网站证书校验不通过，那么浏览器地址栏里的小锁头就不见了，取而代之的是一个浏览警告
- 所以如果浏览器出现了警告，就说明可能是发生了中间人攻击，或者网站的证书被吊销





## https防火墙工作原理

- 如果按照这种方式，那么HTTPS防火墙是不可能截获客户端到服务器之间的通信内容的。所以HTTPS防火墙要做的一件事就是，强制安装一个证书到“受信任”列表中（也就是上图我涂黑的那两个证书，就是HTTPS防火墙为了能够工作，强制IT部门安装到每个公司的PC上的）。有了这个“受信任”证书，HTTPS防火墙，也就是中间人，即可把任何想要监听的网站的证书，都替换成这个“受信任”证书，之后通过HTTPS防火墙内置的私钥，解开客户端到服务器之间的全部加密通信
- 而这种方法的问题是，如果防火墙本身被攻击，或是因此发生了密钥泄漏，那么就会有安全隐患
- 通常来说能同时掌握证书+网关硬件，才能做到完整的中间人攻击，一般来说，只有在公司（电脑+网络都属于公司）的情况下才能做到。或者，是国家级的行为，然后把中间人部署到ISP的网关上。当然，国家级的行为，也没必要这么费劲，有其它（物理）办法就是了







# sql注入攻击

## 定义

- 攻击者在HTTP请求中注入恶意的SQL代码，服务器使用参数构建数据库SQL命令时，恶意SQL被一起构造，并在数据库中执行



## 举例

- 用户登录，输入用户名 lianggzone，密码 ‘ or ‘1’=’1 ，如果此时使用参数构造的方式，就会出现 select * from user where name = ‘lianggzone’ and password = ‘’ or ‘1’=‘1’
- 不管用户名和密码是什么内容，使查询出来的用户列表不为空



## 解决办法

- Web端
  - 有效性检验
  - 限制字符串输入的长度

- 服务端
  - 不用拼接SQL字符串
  - 使用预编译的PrepareStatement
  - 有效性检验。(为什么服务端还要做有效性检验？第一准则，外部都是不可信的，防止攻击者绕过 Web端请求）
  - 过滤SQL需要的参数中的特殊字符。比如单引号、双引号







# 参考

- https://zhuanlan.zhihu.com/p/412540663