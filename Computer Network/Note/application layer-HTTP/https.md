# SSL

## 定义

- SSL代表安全套接字层
- 它是一种用于加密和验证应用程序（如浏览器）和Web服务器之间发送的数据的协议
- 加密数据，维护数据的完整性的应用层协议加密和解密需要两个不同的密钥，故被称为**非对称加密**



# ssh

- （安全外壳协议）

- 定义：
  - Secure Shell（安全外壳协议，简称SSH）是一种加密的网络传输协议，可在不安全的网络中为网络服务提供安全的传输环境
- SSH通过在网络中创建安全隧道来实现SSH客户端与服务器之间的连接
- SSH最常见的用途是远程登录系统，人们通常利用SSH来传输命令行界面和远程执行命令。SSH使用频率最高的场合是类Unix系统，但是Windows操作系统也能有限度地使用SSH
- SSH以非对称加密实现身份验证[2]。身份验证有多种途径，例如其中一种方法是使用自动生成的公钥-私钥对来简单地加密网络连接，随后使用密码认证进行登录；另一种方法是人工生成一对公钥和私钥，通过生成的密钥进行认证，这样就可以在不输入密码的情况下登录。任何人都可以自行生成密钥。公钥需要放在待访问的电脑之中，而对应的私钥需要由用户自行保管。认证过程基于生成出来的私钥，但整个认证过程中私钥本身不会传输到网络中。
- SSH协议有两个主要版本，分别是SSH-1和SSH-2。无论是哪个版本，核实未知密钥来源都是重要的事情，因为SSH只验证提供用户是否拥有与公钥相匹配的私钥，只要接受公钥而且密钥匹配服务器就会授予许可。这样的话，一旦接受了恶意攻击者的公钥，那么系统也会把攻击者视为合法用户







# https的流程

- 客户端向服务器端发送ssl连接请求
- 服务器把公钥发送给客户端，并且服务器端保存着唯一的密钥
- 客户端用服务器公钥对双方通信用的对称密钥进行加密，并发送给服务器端
- 服务端用本地的非对称密钥对发来的对称密钥进行解密
- 此时，双方都有了一个对称密钥，可以用这个密钥进行通信
  - 进行数据传输，服务器和客户端双方用公有的相同的对称秘钥对数据进行加密解密，可以保证在数据收发过程中的安全，即是第三方获得数据包，也无法对其进行加密，解密和篡改



数字签名、摘要是证书防伪非常关键的武器。“摘要”就是对传输的内容，通过hash算法计算出一段固定长度的串。然后，通过发送方的私钥对这段摘要进行加密，加密后得到的结果就是“数字签名”







# 如何保证公钥不被篡改

将公钥放在数字证书中。只要证书是可信的，公钥就是可信的。

公钥加密计算量太大，如何减少耗用的时间？

每一次对话（session），客户端和服务器端都生成一个"对话密钥"（sessionkey），用它来加密信息。由于"对话密钥"是对称加密，所以运算速度非常快，而服务器公钥只用于加密"对话密钥"本身，这样就减少了加密运算的消耗时间。

（1）客户端向服务器端索要并验证公钥。（2）双方协商生成"对话密钥"。（3）双方采用"对话密钥"进行加密通信。上面过程的前两步，又称为"握手阶段"（handshake）。







# 对称加密

- 对称密钥加密（Symmetric-KeyEncryption），加密和解密使用同一密钥
- 优点：运算速度快
- 缺点：无法安全地将密钥传输给通信方







# 非对称加密

- 非对称密钥加密，又称公开密钥加密（Public-KeyEncryption），加密和解密使用不同的密钥
- 公开密钥所有人都可以获得，通信发送方获得接收方的公开密钥之后，就可以使用公开密钥进行加密，接收方收到通信内容后使用私有密钥解密
- 非对称密钥除了用来加密，还可以用来进行签名。因为私有密钥无法被其他人获取，因此通信发送方使用其私有密钥进行签名，通信接收方使用发送方的公开密钥对签名进行解密，就能判断这个签名是否正确
- 优点：可以更安全地将公开密钥传输给通信发送方
- 缺点：运算速度慢







# https

- HTTPS并不是新协议，而是让HTTP先和SSL（SecureSocketsLayer）通信，再由SSL和TCP通信，也就是说HTTPS使用了隧道进行通信。通过使用SSL，HTTPS具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）







# 为什么有的时候刷新页面不需要重新建立SSL连接

- TCP连接有的时候会被浏览器和服务端维持一段时间，TCP不需要重新建立，SSL自然也会用之前的







# HTTPS采用的加密方式有哪些

- HTTPS采用混合的加密机制，使用非对称密钥加密用于传输对称密钥来保证传输过程的安全性，之后使用对称密钥加密进行通信来保证通信过程的效率
- 确保传输安全过程（其实就是rsa原理）
  - 1.Client给出协议版本号、一个客户端生成的随机数（Clientrandom），以及客户端支持的加密方法
  - 2.Server确认双方使用的加密方法，并给出数字证书、以及一个服务器生成的随机数（Serverrandom）
  - 3.Client确认数字证书有效，然后生成呀一个新的随机数（Premastersecret），并使用数字证书中的公钥，加密这个随机数，发给Server
  - 4.Server使用自己的私钥，获取Client发来的随机数（Premastersecret）
  - 5.Client和Server根据约定的加密方法，使用前面的三个随机数，生成”对话密钥”（sessionkey），用来加密接下来的整个对话过程。






# SSL中的认证的证书是什么

- 通过使用证书来对通信方进行认证
- 数字证书认证机构（CA，CertificateAuthority）是客户端与服务器双方都可信赖的第三方机构
- 服务器的运营人员向CA提出公开密钥的申请，CA在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公开密钥证书后绑定在一起
- 进行HTTPS通信时，服务器会把证书发送给客户端。客户端取得其中的公开密钥之后，先使用数字签名进行验证，如果验证通过，就可以开始通信了