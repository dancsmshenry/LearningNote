# Session

## 定义

- 客户端登录完成之后，服务器会创建对应的session，session创建完之后，会把session的id发送给客户端，客户端再存储到浏览器中
- 这样客户端每次访问服务器时，都会带着sessionid，服务器拿到sessionid之后，在内存找到与之对应的session这样就可以正常工作了



## 举例

- 用户进行登录时，用户提交包含用户名和密码的表单，放入HTTP请求报文中；
- 服务器验证该用户名和密码，如果正确则把用户信息存储到Redis中，它在Redis中的Key称为SessionID；
- 服务器返回的响应报文的Set-Cookie首部字段包含了这个SessionID，客户端收到响应报文之后将该Cookie值存入浏览器中；
- 客户端之后对同一个服务器进行请求时会包含该Cookie值，服务器收到之后提取出SessionID，从Redis中取出用户信息，继续之前的业务操作



## 缺点

- SessionID的安全性问题，不能让它被恶意攻击者轻易获取，那么就不能产生一个容易被猜到的SessionID值此外，还需要经常重新生成SessionID在对安全性要求极高的场景下，例如转账等操作，除了使用Session管理用户状态之外，还需要对用户进行重新验证，比如重新输入密码，或者使用短信验证码等方式







# Cookie

## 背景

- HTTP协议是无状态的，主要是为了让HTTP协议尽可能简单，使得它能够处理大量事务，**HTTP/1.1**引入Cookie来保存状态信息
  - 因为HTTP是无状态的一种协议，换句话说，服务器记不住你，可能你每刷新一次网页，就要重新输入一次账号密码进行登录，这显然是让人无法接受的
  - cookie的作用就好比服务器给你贴个标签，然后你每次向服务器再发请求时，服务器就能够cookie认出你



## 定义

- Cookie是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器向同一服务器再次发起请求时被携带上，用于告知服务端两个请求是否来自同一浏览器由于之后每次请求都会需要携带Cookie数据，因此会带来额外的性能开销（尤其是在移动环境下）

- Cookie曾一度用于客户端数据的存储，因为当时并没有其它合适的存储办法而作为唯一的存储手段，但现在随着现代浏览器开始支持各种各样的存储方式，Cookie渐渐被淘汰
  - 新的浏览器API已经允许开发者直接将数据存储到本地，如使用WebstorageAPI（本地存储和会话存储）或IndexedDB



- Cookie在客户端的保存形式可以有两种，一种是会话Cookie，一种是持久Cookie
  - 会话Cookie就是将服务器返回的Cookie字符串保持在内存中，关闭浏览器之后自动销毁
  - 持久Cookie则是存储在客户端磁盘上，其有效时间在服务器响应头中被指定，在有效期内，客户端再次请求服务器时都可以直接从本地取出需要说明的是，存储在磁盘中的Cookie是可以被多个浏览器代理所共享的



## 用途

- 会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）
- 个性化设置（如用户自定义设置、主题等）
- 浏览器行为跟踪（如跟踪分析用户行为等）







# cookie和session的对比

- cookie是客户端保持状态的方法
  - 简单的理解就是存储由服务器发至客户端并由客户端保存的一段字符串为了保持会话，服务器可以在响应客户端请求时将Cookie字符串放在Set-Cookie下，客户机收到Cookie之后保存这段字符串，之后再请求时候带上Cookie就可以被识别
- session是服务器保持状态的方法
  - Session保存在服务器上，可以保存在数据库、文件或内存中，每个用户有独立的Session用户在客户端上记录用户的操作我们可以理解为每个用户有一个独一无二的SessionID作为Session文件的Hash键，通过这个值可以锁定具体的Session结构的数据，这个Session结构中存储了用户操作行为



- 存储数据类型不同
  - Cookie只能存储ASCII码字符串
  - Session则可以存储任何类型的数据，因此在考虑数据复杂性时首选Session

- 存储的位置不同
  - cookie：存放在客户端的浏览器中（容易被恶意查看如果非要将一些隐私数据存在Cookie中，可以将Cookie值进行加密，然后在服务器进行解密）
  - session：存放在服务端Session存储的数据比较安全（对于大型网站，如果用户所有的信息都存储在Session中，那么开销是非常大的，因此不建议将所有的用户信息都存储到Session中）
- 存储的数据类型不同两者都是key-value的结构，但针对value的类型是有差异的
  - cookie：value只能是字符串类型
  - session：value是Object类型
- 存储的数据大小限制不同
  - cookie：大小受浏览器的限制，很多是4K的大小
  - session：受当前内存的限制
- 生命周期不同
  - cookie的生命周期是累计的，从创建时，就开始计时，20分钟后，cookie生命周期结束（不受浏览器关闭的影响，即使中途有访问cookie，也不会刷新计时器）
  - session的生命周期是间隔的，从创建时，开始计时，如在20分钟，没有访问session，那么session生命周期被销毁；如果中途有访问session，则计时器就要重新计时