# 简单的HTTP协议

## 客户端和服务器

- 客户端定义：
  - 客户端（Client）或称为用户端，是指与服务器相对应，为客户提供本地服务的程序。除了一些只在本地运行的应用程序之外，一般安装在普通的客户机上，需要与服务端互相配合运行





## HTTP报文组成

- 具体的报文内容

  - 请求首部字段
    - 开头表明使用什么方法请求访问服务器（get，post）
      - get获取资源
      - post传输实体主体
      - put传输文件（存在安全问题）
      - head获取报文首部，用于确认uri的有效性以及资源更新的日期时间
      - delete删除文件
      - options询问支持的方法
      - trace追踪路径
      - connect要求用隧道协议连接代理
    - 随后的字符串是指资源对象的url
    - 最后是http的版本号
  - 状态码（dddd）及其原因
  - 创建响应的日期时间
  - 资源主体的实体






## 无状态协议

- 由此引出cookie和session
- 定义：
  - 指比如客户获得一张网页之后关闭浏览器，然后再一次启动浏览器，再登录该网站，但是服务器并不知道客户关闭了一次浏览器





## HTTP方法

- get获取资源
- post传输实体主体
- put传输文件（存在安全问题）
- head获取报文首部，用于确认uri的有效性以及资源更新的日期时间
- delete删除文件
- options询问支持的方法
- trace追踪路径
- connect要求用隧道协议连接代理



## Get和Post的区别

- 安全方面
  - 按照网上大部分文章的解释，POST 比 GET 安全，因为数据在地址栏上不可见。然而，从传输的角度来说，他们都是不安全的，因为 HTTP 在网络上是明文传输的，只要在网络节点上捉包，就能完整地获取数据报文，要想安全传输，就只有加密，也就是 HTTPS
  - GET参数通过URL传递，POST放在Request body中
- get请求的长度限制
  - HTTP 协议没有 Body 和 URL 的长度限制，对 URL 限制的大多是浏览器和服务器的原因
  - 浏览器原因就不说了，服务器是因为处理长 URL 要消耗比较多的资源，为了性能和安全（防止恶意构造长 URL 来攻击）考虑，会给 URL 长度加限制
- post只会产生一个TCP数据包
  - header 和 body 分开发送是部分浏览器或框架的请求方法，不属于 post 必然行为
    - post 会将 header 和 body 分开发送，先发送 header，服务端返回 100 状态码再发送 body，即这种情况是**特殊情况**



## 持久连接

- 持久连接（在http1.1中都是持久连接，但是http1.1中未被标准化）





## 管线化

- 定义：HTTP管线化（英语：HTTP pipelining）是将多个HTTP请求（request）整批提交的技术，而在发送过程中不需先等待伺服端的回应
- 原因及解释：
  - 通常，HTTP请求总是顺序发送的，下一个请求只有在当前请求的响应被完全接受的时候才会被发送。由于网络延迟和带宽的限制，这样会导致在服务器发送下一个响应的时候中间有很大的延迟
  - HTTP/1.1允许多个HTTP请求通过一个套接字同时被输出 ，而不用等待相应的响应。然后请求者就会等待各自的响应，这些响应是按照之前请求的顺序依次到达
- 只有**幂等**的请求才能被管线化
- 幂等：
  - 定义：在编程中一个幂等操作的特点是其**任意多次**执行所产生的**影响**均与**一次执行**的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数
  - 即`f(f(x))=f(x)`
  - HTTP/方法的幂等性：
    - 是指一次和多次请求某一个资源应该具有同样的副作用。幂等性的请求，实际上就是多次操作都不会改变结果的请求，比如GET，我可以多次从同一个地方获取资源，但是对于资源本身来说并不会发生什么变化，我GET10次和GET100次，资源都没有发生任何变化。而Post则不同了，我提交表单10次，和100次，造成的结果是不同的，至少数据库里新增的数据有不同
- HTTP管线化不是HTTP2的内容，是对HTTP1.1协议下，服务器不能很好处理并行请求的一个改进。
- 在正确实现的条件下， GET ， HEAD ， PUT 和 DELETE  等方法都是幂等的，而  POST  方法不是。所有的 safe 方法也都是幂等的
  - 如post请求，调用多次后后增加多行记录
  - 而delete方法，可能会造成返回码不同（可要这么说，不都会不同吗）
    - 解释：
      - 幂等性只与后端服务器的实际状态有关，而每一次请求接收到的状态码不一定相同
      - 一个HTTP方法是**幂等**的，指的是同样的请求被执行一次与连续执行多次的**效果**是一样的，这里是指效果一样
- 需要注意的是，服务器不一定会确保请求方法的幂等性，有些应用可能会错误地打破幂等性约束
- 不应该在建立新连接的时候发出管线化的请求 ，因为不能确源服务或代理是否支持HTTP/1.1





## cookie

- 有了cookie后，请求报文后会有cookie一行
- 定义：指某些网站为了辨别用户身份而储存在用户本地终端（Client Side）上的数据（通常经过加密）
- 分类：
  - Cookie 保存在客户端中，按在客户端中的存储位置，可分为内存 Cookie 和硬盘 Cookie。
  - 内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭即消失，存在时间短暂。硬盘 Cookie 保存在硬盘里，有过期时间，除非用户手动清理或到了过期时间，硬盘 Cookie 不会清除，存在时间较长。所以，按存在时间，可分为非持久 Cookie 和持久 Cookie
- 原因：HTTP协议是无状态的
- 缺点：
  - Cookie 会被附加在每个 HTTP 请求中，所以无形中增加了流量。
  - 由于 HTTP 请求中的 Cookie 是明文传递的，所以安全性成问题，除非使用超文本传输安全协定
  - Cookie 的大小限制在 4 KB 左右，对于复杂的存储需求来说是不够用的